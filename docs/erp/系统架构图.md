# AI ERP 系统整体架构图

## 🏗️ 系统架构概览

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                                AI ERP 系统架构                                  │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│    Web前端      │    │    移动端       │    │   外部ERP系统   │
│  (Vue3+TS)      │    │  (uni-app)      │    │ (SAP/用友)      │
│                 │    │                 │    │                 │
│ • 数据集成页     │    │ • 语音操作页     │    │ • SAP系统       │
│ • 指标预测页     │    │ • 同步状态页     │    │ • 用友系统      │
│ • 订单协同页     │    │ • 离线缓存页     │    │ • 其他ERP       │
│ • 流程监管页     │    │                 │    │                 │
└─────────┬───────┘    └─────────┬───────┘    └─────────┬───────┘
          │                      │                      │
          │ HTTP/WebSocket       │ WebSocket/HTTP       │ DataX同步
          │                      │                      │
┌─────────▼───────────────────────────────────────────────────────▼───────┐
│                           后端服务层                                    │
│                        (FastAPI + Python)                              │
├─────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │ 数据集成模块 │  │ 指标预测模块 │  │ 流程监管模块 │  │ 订单协同模块 │    │
│  │             │  │             │  │             │  │             │    │
│  │ • DataX同步  │  │ • LLM预测   │  │ • Drools引擎 │  │ • 文本处理   │    │
│  │ • 数据清洗   │  │ • 传统模型   │  │ • AI自迭代   │  │ • 语音处理   │    │
│  │ • 字段映射   │  │ • 模型切换   │  │ • 分级告警   │  │ • 实时同步   │    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
├─────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │  LLM集成层   │  │  规则引擎层  │  │  数据处理层  │  │  实时通信层  │    │
│  │             │  │             │  │             │  │             │    │
│  │ • Qwen API  │  │ • Drools    │  │ • Pandas    │  │ • WebSocket  │    │
│  │ • DeepSeek  │  │ • 规则管理   │  │ • BERT NLP  │  │ • 实时推送   │    │
│  │ • 成本控制   │  │ • 性能分析   │  │ • 数据转换   │  │ • 离线缓存   │    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
└─────────┬───────────────────────────────────────────────────────────────┘
          │
          │ 数据存储
          │
┌─────────▼───────────────────────────────────────────────────────────────┐
│                            数据存储层                                   │
│                                                                         │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │   MongoDB    │  │  MySQL      │  │  Snowflake   │  │   缓存层     │    │
│  │             │  │             │  │             │  │             │    │
│  │ • 规则数据   │  │ • 订单记录   │  │ • 历史数据   │  │ • Redis     │    │
│  │ • 告警数据   │  │ • 用户数据   │  │ • 分析数据   │  │ • 热点缓存   │    │
│  │ • 配置数据   │  │ • 日志数据   │  │ • 报表数据   │  │ • 会话缓存   │    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
└─────────────────────────────────────────────────────────────────────────┘
```

## 🔄 核心业务流程

### 1. 数据集成流程
```
外部ERP → DataX → 数据清洗 → Snowflake → MongoDB缓存 → 前端展示
```

### 2. 指标预测流程
```
历史数据 → LLM分析 → 预测结果 → 模型切换(备用) → 前端图表
```

### 3. 流程监管流程
```
业务数据 → Drools规则 → AI自迭代 → 分级告警 → 解决方案输出
```

### 4. 订单协同流程
```
Web文本输入 / 移动端语音 → BERT解析 → 订单操作 → 实时同步 → 多端更新
```

## 🎯 技术栈说明

### 前端层
- **Web端**: Vue3 + TypeScript + Element Plus + ECharts
- **移动端**: uni-app + 原生语音API + WebSocket

### 后端层
- **框架**: FastAPI + Python 3.9+
- **AI集成**: Qwen/DeepSeek LLM + BERT NLP
- **规则引擎**: Drools + JPype
- **数据处理**: Pandas + DataX

### 数据层
- **主数据库**: MongoDB (规则、告警、配置)
- **关系数据库**: MySQL (订单、用户、日志)
- **数据仓库**: Snowflake (历史数据、分析)
- **缓存**: Redis (热点数据、会话)

## 🔗 关键接口

### API接口
- `/api/data/*` - 数据集成接口
- `/api/predict/*` - 预测分析接口
- `/api/process/*` - 流程监管接口
- `/api/orders/*` - 订单管理接口
- `/api/mobile/*` - 移动端专用接口

### WebSocket接口
- `/ws/mobile/orders` - 移动端实时同步
- `/ws/alerts` - 告警实时推送
- `/ws/data/sync` - 数据同步状态

## 🚀 部署架构

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Web服务器     │    │   应用服务器     │    │   数据库服务器   │
│                 │    │                 │    │                 │
│ • Nginx         │    │ • FastAPI       │    │ • MongoDB       │
│ • 静态资源      │    │ • Python服务    │    │ • MySQL         │
│ • 负载均衡      │    │ • 容器化部署    │    │ • Snowflake     │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

## 📊 系统特点

1. **AI驱动**: 集成大模型进行智能预测和规则优化
2. **多端协同**: Web端和移动端实时数据同步
3. **规则引擎**: Drools支持复杂业务规则定义
4. **分级告警**: 五级告警体系，智能解决方案输出
5. **离线支持**: 移动端离线缓存，网络恢复自动同步
6. **扩展性强**: 模块化设计，支持多种ERP系统对接
