# 报工一览表智能体技术方案

## 📋 需求概述

基于 `报工一览表所需数据.xlsx` 文件，开发一个智能体页面，支持用户通过关键字搜索报工数据，并以表格形式展示搜索结果。

## 🎯 功能需求

### 核心功能
1. **数据导入**：将Excel文件中的报工数据导入到数据库
2. **智能搜索**：支持关键字模糊搜索，快速定位相关报工记录
3. **表格展示**：以清晰的表格形式展示搜索结果
4. **数据筛选**：支持多维度数据筛选和排序

### 用户交互
- 输入搜索关键字（如：员工姓名、项目名称、日期等）
- 实时搜索结果显示
- 支持高级筛选条件
- 支持数据导出功能

## 🏗️ 技术架构

### 系统架构图
```
┌─────────────────────────────────────────────────────────────────┐
│                        报工智能体系统                            │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   前端页面      │    │   后端API       │    │   数据库        │
│                 │    │                 │    │                 │
│ • 搜索界面      │    │ • 数据导入API   │    │ • 报工主表      │
│ • 结果展示      │    │ • 搜索API       │    │ • 员工信息表    │
│ • 筛选组件      │    │ • 导出API       │    │ • 项目信息表    │
│ • 数据导出      │    │ • 统计API       │    │ • 部门信息表    │
└─────────┬───────┘    └─────────┬───────┘    └─────────┬───────┘
          │                      │                      │
          │ HTTP/WebSocket       │ MongoDB/MySQL        │
          │                      │                      │
┌─────────▼───────────────────────────────────────────────────────┐
│                        智能搜索引擎                             │
│                                                                 │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐            │
│  │ 全文搜索     │  │ 模糊匹配     │  │ 智能推荐     │            │
│  │             │  │             │  │             │            │
│  │ • 关键字索引 │  │ • 拼音搜索   │  │ • 相关推荐   │            │
│  │ • 分词处理   │  │ • 模糊查询   │  │ • 历史搜索   │            │
│  │ • 权重排序   │  │ • 容错处理   │  │ • 智能提示   │            │
│  └─────────────┘  └─────────────┘  └─────────────┘            │
└─────────────────────────────────────────────────────────────────┘
```

## 📊 数据库设计

### 1. 报工主表 (work_reports)
```sql
CREATE TABLE work_reports (
    id VARCHAR(50) PRIMARY KEY COMMENT '报工ID',
    employee_id VARCHAR(50) NOT NULL COMMENT '员工ID',
    project_id VARCHAR(50) NOT NULL COMMENT '项目ID',
    department_id VARCHAR(50) NOT NULL COMMENT '部门ID',
    report_date DATE NOT NULL COMMENT '报工日期',
    work_hours DECIMAL(5,2) NOT NULL COMMENT '工作时长(小时)',
    work_content TEXT COMMENT '工作内容',
    work_location VARCHAR(100) COMMENT '工作地点',
    status ENUM('pending', 'approved', 'rejected') DEFAULT 'pending' COMMENT '状态',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    INDEX idx_employee_date (employee_id, report_date),
    INDEX idx_project_date (project_id, report_date),
    INDEX idx_department_date (department_id, report_date),
    FULLTEXT INDEX idx_content (work_content)
) COMMENT '报工主表';
```

### 2. 员工信息表 (employees)
```sql
CREATE TABLE employees (
    id VARCHAR(50) PRIMARY KEY COMMENT '员工ID',
    employee_no VARCHAR(20) UNIQUE NOT NULL COMMENT '员工编号',
    name VARCHAR(50) NOT NULL COMMENT '员工姓名',
    pinyin VARCHAR(100) COMMENT '姓名拼音',
    phone VARCHAR(20) COMMENT '手机号',
    email VARCHAR(100) COMMENT '邮箱',
    position VARCHAR(50) COMMENT '职位',
    department_id VARCHAR(50) COMMENT '部门ID',
    hire_date DATE COMMENT '入职日期',
    status ENUM('active', 'inactive') DEFAULT 'active' COMMENT '状态',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    INDEX idx_name (name),
    INDEX idx_pinyin (pinyin),
    INDEX idx_employee_no (employee_no),
    INDEX idx_department (department_id)
) COMMENT '员工信息表';
```

### 3. 项目信息表 (projects)
```sql
CREATE TABLE projects (
    id VARCHAR(50) PRIMARY KEY COMMENT '项目ID',
    project_code VARCHAR(20) UNIQUE NOT NULL COMMENT '项目编码',
    project_name VARCHAR(100) NOT NULL COMMENT '项目名称',
    project_type VARCHAR(50) COMMENT '项目类型',
    manager_id VARCHAR(50) COMMENT '项目经理ID',
    start_date DATE COMMENT '开始日期',
    end_date DATE COMMENT '结束日期',
    status ENUM('planning', 'active', 'completed', 'suspended') DEFAULT 'active' COMMENT '项目状态',
    description TEXT COMMENT '项目描述',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    INDEX idx_name (project_name),
    INDEX idx_code (project_code),
    INDEX idx_manager (manager_id),
    INDEX idx_status (status)
) COMMENT '项目信息表';
```

### 4. 部门信息表 (departments)
```sql
CREATE TABLE departments (
    id VARCHAR(50) PRIMARY KEY COMMENT '部门ID',
    department_code VARCHAR(20) UNIQUE NOT NULL COMMENT '部门编码',
    department_name VARCHAR(50) NOT NULL COMMENT '部门名称',
    parent_id VARCHAR(50) COMMENT '上级部门ID',
    manager_id VARCHAR(50) COMMENT '部门经理ID',
    level INT DEFAULT 1 COMMENT '部门层级',
    sort_order INT DEFAULT 0 COMMENT '排序',
    status ENUM('active', 'inactive') DEFAULT 'active' COMMENT '状态',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    INDEX idx_name (department_name),
    INDEX idx_code (department_code),
    INDEX idx_parent (parent_id),
    INDEX idx_level (level)
) COMMENT '部门信息表';
```

## 🔧 后端实现

### 1. 数据模型 (schemas)

#### 报工数据模型
```python
# backend/app/schemas/work_report.py
from pydantic import BaseModel, Field
from datetime import date, datetime
from typing import Optional
from enum import Enum

class WorkReportStatus(str, Enum):
    PENDING = "pending"
    APPROVED = "approved"
    REJECTED = "rejected"

class WorkReportBase(BaseModel):
    employee_id: str = Field(..., description="员工ID")
    project_id: str = Field(..., description="项目ID")
    department_id: str = Field(..., description="部门ID")
    report_date: date = Field(..., description="报工日期")
    work_hours: float = Field(..., ge=0, le=24, description="工作时长")
    work_content: Optional[str] = Field(None, description="工作内容")
    work_location: Optional[str] = Field(None, description="工作地点")
    status: WorkReportStatus = Field(WorkReportStatus.PENDING, description="状态")

class WorkReportCreate(WorkReportBase):
    pass

class WorkReportUpdate(BaseModel):
    work_hours: Optional[float] = Field(None, ge=0, le=24)
    work_content: Optional[str] = None
    work_location: Optional[str] = None
    status: Optional[WorkReportStatus] = None

class WorkReportResponse(WorkReportBase):
    id: str
    created_at: datetime
    updated_at: datetime
    
    # 关联信息
    employee_name: Optional[str] = None
    project_name: Optional[str] = None
    department_name: Optional[str] = None
    
    class Config:
        from_attributes = True

class WorkReportSearchRequest(BaseModel):
    keyword: Optional[str] = Field(None, description="搜索关键字")
    employee_name: Optional[str] = Field(None, description="员工姓名")
    project_name: Optional[str] = Field(None, description="项目名称")
    department_name: Optional[str] = Field(None, description="部门名称")
    start_date: Optional[date] = Field(None, description="开始日期")
    end_date: Optional[date] = Field(None, description="结束日期")
    status: Optional[WorkReportStatus] = Field(None, description="状态")
    page: int = Field(1, ge=1, description="页码")
    size: int = Field(20, ge=1, le=100, description="每页数量")
```

### 2. 数据访问层 (repository)

```python
# backend/app/repository/work_report_repo.py
from typing import List, Optional, Dict, Any
from datetime import date
from pymongo import MongoClient
from bson import ObjectId
import re

class WorkReportRepository:
    def __init__(self, db):
        self.db = db
        self.collection = db.work_reports
    
    async def search_work_reports(
        self, 
        keyword: Optional[str] = None,
        employee_name: Optional[str] = None,
        project_name: Optional[str] = None,
        department_name: Optional[str] = None,
        start_date: Optional[date] = None,
        end_date: Optional[date] = None,
        status: Optional[str] = None,
        page: int = 1,
        size: int = 20
    ) -> Dict[str, Any]:
        """智能搜索报工记录"""
        
        # 构建查询条件
        query = {}
        
        # 关键字搜索（全文搜索）
        if keyword:
            query["$or"] = [
                {"work_content": {"$regex": keyword, "$options": "i"}},
                {"employee_name": {"$regex": keyword, "$options": "i"}},
                {"project_name": {"$regex": keyword, "$options": "i"}},
                {"department_name": {"$regex": keyword, "$options": "i"}},
                {"work_location": {"$regex": keyword, "$options": "i"}}
            ]
        
        # 精确匹配
        if employee_name:
            query["employee_name"] = {"$regex": employee_name, "$options": "i"}
        if project_name:
            query["project_name"] = {"$regex": project_name, "$options": "i"}
        if department_name:
            query["department_name"] = {"$regex": department_name, "$options": "i"}
        if status:
            query["status"] = status
        
        # 日期范围
        if start_date or end_date:
            date_query = {}
            if start_date:
                date_query["$gte"] = start_date
            if end_date:
                date_query["$lte"] = end_date
            query["report_date"] = date_query
        
        # 执行查询
        total = await self.collection.count_documents(query)
        skip = (page - 1) * size
        
        cursor = self.collection.find(query).skip(skip).limit(size).sort("report_date", -1)
        results = await cursor.to_list(length=size)
        
        return {
            "total": total,
            "page": page,
            "size": size,
            "data": results
        }
    
    async def get_work_report_statistics(self) -> Dict[str, Any]:
        """获取报工统计信息"""
        pipeline = [
            {
                "$group": {
                    "_id": None,
                    "total_reports": {"$sum": 1},
                    "total_hours": {"$sum": "$work_hours"},
                    "avg_hours": {"$avg": "$work_hours"}
                }
            }
        ]
        
        result = await self.collection.aggregate(pipeline).to_list(1)
        return result[0] if result else {}
    
    async def import_excel_data(self, data: List[Dict]) -> int:
        """导入Excel数据"""
        try:
            result = await self.collection.insert_many(data)
            return len(result.inserted_ids)
        except Exception as e:
            raise Exception(f"数据导入失败: {str(e)}")
```

### 3. API接口 (routes)

```python
# backend/app/api/v1/work_reports.py
from fastapi import APIRouter, Depends, HTTPException, Query
from typing import Optional, List
from datetime import date
from ...schemas.work_report import (
    WorkReportResponse, 
    WorkReportSearchRequest,
    WorkReportCreate,
    WorkReportUpdate
)
from ...repository.work_report_repo import WorkReportRepository
from ...db.mongo import get_db

router = APIRouter(prefix="/work-reports", tags=["报工管理"])

@router.get("/search", response_model=Dict[str, Any])
async def search_work_reports(
    keyword: Optional[str] = Query(None, description="搜索关键字"),
    employee_name: Optional[str] = Query(None, description="员工姓名"),
    project_name: Optional[str] = Query(None, description="项目名称"),
    department_name: Optional[str] = Query(None, description="部门名称"),
    start_date: Optional[date] = Query(None, description="开始日期"),
    end_date: Optional[date] = Query(None, description="结束日期"),
    status: Optional[str] = Query(None, description="状态"),
    page: int = Query(1, ge=1, description="页码"),
    size: int = Query(20, ge=1, le=100, description="每页数量"),
    db = Depends(get_db)
):
    """智能搜索报工记录"""
    try:
        repo = WorkReportRepository(db)
        result = await repo.search_work_reports(
            keyword=keyword,
            employee_name=employee_name,
            project_name=project_name,
            department_name=department_name,
            start_date=start_date,
            end_date=end_date,
            status=status,
            page=page,
            size=size
        )
        return {
            "success": True,
            "data": result
        }
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))

@router.post("/import")
async def import_excel_data(
    data: List[Dict],
    db = Depends(get_db)
):
    """导入Excel数据"""
    try:
        repo = WorkReportRepository(db)
        count = await repo.import_excel_data(data)
        return {
            "success": True,
            "message": f"成功导入 {count} 条记录",
            "count": count
        }
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))

@router.get("/statistics")
async def get_statistics(db = Depends(get_db)):
    """获取报工统计信息"""
    try:
        repo = WorkReportRepository(db)
        stats = await repo.get_work_report_statistics()
        return {
            "success": True,
            "data": stats
        }
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))

@router.get("/export")
async def export_data(
    keyword: Optional[str] = None,
    start_date: Optional[date] = None,
    end_date: Optional[date] = None,
    db = Depends(get_db)
):
    """导出数据"""
    try:
        repo = WorkReportRepository(db)
        result = await repo.search_work_reports(
            keyword=keyword,
            start_date=start_date,
            end_date=end_date,
            page=1,
            size=10000  # 导出所有数据
        )
        return {
            "success": True,
            "data": result["data"]
        }
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))
```

## 🎨 前端实现

### 1. 智能体页面组件

```vue
<!-- frontend/src/pages/WorkReportAgent.vue -->
<template>
  <div class="work-report-agent">
    <a-card title="报工智能体" :bordered="false">
      <!-- 搜索区域 -->
      <div class="search-section">
        <a-row :gutter="16">
          <a-col :span="8">
            <a-input
              v-model:value="searchForm.keyword"
              placeholder="输入关键字搜索（员工姓名、项目名称、工作内容等）"
              @pressEnter="handleSearch"
              allowClear
            >
              <template #prefix>
                <SearchOutlined />
              </template>
            </a-input>
          </a-col>
          <a-col :span="4">
            <a-input
              v-model:value="searchForm.employee_name"
              placeholder="员工姓名"
              allowClear
            />
          </a-col>
          <a-col :span="4">
            <a-input
              v-model:value="searchForm.project_name"
              placeholder="项目名称"
              allowClear
            />
          </a-col>
          <a-col :span="4">
            <a-select
              v-model:value="searchForm.status"
              placeholder="状态"
              allowClear
              style="width: 100%"
            >
              <a-select-option value="pending">待审核</a-select-option>
              <a-select-option value="approved">已通过</a-select-option>
              <a-select-option value="rejected">已拒绝</a-select-option>
            </a-select>
          </a-col>
          <a-col :span="4">
            <a-space>
              <a-button type="primary" @click="handleSearch">
                <SearchOutlined /> 搜索
              </a-button>
              <a-button @click="handleReset">
                <ReloadOutlined /> 重置
              </a-button>
            </a-space>
          </a-col>
        </a-row>
        
        <!-- 高级搜索 -->
        <a-collapse v-model:activeKey="advancedSearchKey" ghost>
          <a-collapse-panel key="advanced" header="高级搜索">
            <a-row :gutter="16">
              <a-col :span="6">
                <a-range-picker
                  v-model:value="dateRange"
                  placeholder="选择日期范围"
                />
              </a-col>
              <a-col :span="6">
                <a-input
                  v-model:value="searchForm.department_name"
                  placeholder="部门名称"
                  allowClear
                />
              </a-col>
              <a-col :span="6">
                <a-button type="primary" @click="handleAdvancedSearch">
                  高级搜索
                </a-button>
              </a-col>
            </a-row>
          </a-collapse-panel>
        </a-collapse>
      </div>

      <a-divider />

      <!-- 统计信息 -->
      <div class="statistics-section">
        <a-row :gutter="16">
          <a-col :span="6">
            <a-statistic title="总报工记录" :value="statistics.total_reports" />
          </a-col>
          <a-col :span="6">
            <a-statistic title="总工作时长" :value="statistics.total_hours" suffix="小时" />
          </a-col>
          <a-col :span="6">
            <a-statistic title="平均工作时长" :value="statistics.avg_hours" suffix="小时" :precision="2" />
          </a-col>
          <a-col :span="6">
            <a-statistic title="搜索结果" :value="searchResult.total" />
          </a-col>
        </a-row>
      </div>

      <a-divider />

      <!-- 结果展示 -->
      <div class="results-section">
        <div class="table-header">
          <a-space>
            <a-button @click="handleExport" :loading="exportLoading">
              <DownloadOutlined /> 导出数据
            </a-button>
            <a-button @click="handleImport">
              <UploadOutlined /> 导入数据
            </a-button>
          </a-space>
        </div>

        <a-table
          :dataSource="searchResult.data"
          :columns="columns"
          :loading="loading"
          :pagination="pagination"
          rowKey="id"
          :scroll="{ x: 1200 }"
        >
          <template #bodyCell="{ column, record }">
            <template v-if="column.key === 'status'">
              <a-tag :color="getStatusColor(record.status)">
                {{ getStatusText(record.status) }}
              </a-tag>
            </template>
            <template v-else-if="column.key === 'work_hours'">
              {{ record.work_hours }}小时
            </template>
            <template v-else-if="column.key === 'actions'">
              <a-space>
                <a-button size="small" @click="handleView(record)">查看</a-button>
                <a-button size="small" type="primary" @click="handleEdit(record)">编辑</a-button>
              </a-space>
            </template>
          </template>
        </a-table>
      </div>
    </a-card>

    <!-- 数据导入模态框 -->
    <a-modal
      v-model:open="importVisible"
      title="导入报工数据"
      @ok="handleImportConfirm"
      :confirmLoading="importLoading"
    >
      <a-upload-dragger
        v-model:fileList="fileList"
        :beforeUpload="beforeUpload"
        accept=".xlsx,.xls"
        :multiple="false"
      >
        <p class="ant-upload-drag-icon">
          <InboxOutlined />
        </p>
        <p class="ant-upload-text">点击或拖拽文件到此区域上传</p>
        <p class="ant-upload-hint">支持 .xlsx 和 .xls 格式</p>
      </a-upload-dragger>
    </a-modal>
  </div>
</template>

<script setup lang="ts">
import { ref, reactive, onMounted, computed } from 'vue'
import { message } from 'ant-design-vue'
import { 
  SearchOutlined, 
  ReloadOutlined, 
  DownloadOutlined, 
  UploadOutlined,
  InboxOutlined 
} from '@ant-design/icons-vue'
import apiClient from '../utils/axios'
import * as XLSX from 'xlsx'

// 响应式数据
const loading = ref(false)
const exportLoading = ref(false)
const importLoading = ref(false)
const importVisible = ref(false)
const advancedSearchKey = ref([])
const fileList = ref([])

// 搜索表单
const searchForm = reactive({
  keyword: '',
  employee_name: '',
  project_name: '',
  department_name: '',
  status: undefined
})

const dateRange = ref([])

// 搜索结果
const searchResult = reactive({
  data: [],
  total: 0,
  page: 1,
  size: 20
})

// 统计信息
const statistics = reactive({
  total_reports: 0,
  total_hours: 0,
  avg_hours: 0
})

// 表格列定义
const columns = [
  {
    title: '员工姓名',
    dataIndex: 'employee_name',
    key: 'employee_name',
    width: 100,
    fixed: 'left'
  },
  {
    title: '项目名称',
    dataIndex: 'project_name',
    key: 'project_name',
    width: 150
  },
  {
    title: '部门',
    dataIndex: 'department_name',
    key: 'department_name',
    width: 100
  },
  {
    title: '报工日期',
    dataIndex: 'report_date',
    key: 'report_date',
    width: 120
  },
  {
    title: '工作时长',
    dataIndex: 'work_hours',
    key: 'work_hours',
    width: 100
  },
  {
    title: '工作内容',
    dataIndex: 'work_content',
    key: 'work_content',
    width: 200,
    ellipsis: true
  },
  {
    title: '工作地点',
    dataIndex: 'work_location',
    key: 'work_location',
    width: 120
  },
  {
    title: '状态',
    dataIndex: 'status',
    key: 'status',
    width: 80
  },
  {
    title: '操作',
    key: 'actions',
    width: 120,
    fixed: 'right'
  }
]

// 分页配置
const pagination = computed(() => ({
  current: searchResult.page,
  pageSize: searchResult.size,
  total: searchResult.total,
  showSizeChanger: true,
  showQuickJumper: true,
  showTotal: (total: number) => `共 ${total} 条记录`,
  onChange: (page: number, size: number) => {
    searchResult.page = page
    searchResult.size = size
    handleSearch()
  }
}))

// 方法
const handleSearch = async () => {
  loading.value = true
  try {
    const params = {
      ...searchForm,
      start_date: dateRange.value?.[0],
      end_date: dateRange.value?.[1],
      page: searchResult.page,
      size: searchResult.size
    }
    
    const { data } = await apiClient.get('/api/work-reports/search', { params })
    if (data.success) {
      searchResult.data = data.data.data
      searchResult.total = data.data.total
    }
  } catch (error) {
    message.error('搜索失败')
  } finally {
    loading.value = false
  }
}

const handleReset = () => {
  Object.assign(searchForm, {
    keyword: '',
    employee_name: '',
    project_name: '',
    department_name: '',
    status: undefined
  })
  dateRange.value = []
  searchResult.page = 1
  handleSearch()
}

const handleAdvancedSearch = () => {
  advancedSearchKey.value = []
  handleSearch()
}

const handleExport = async () => {
  exportLoading.value = true
  try {
    const params = {
      keyword: searchForm.keyword,
      start_date: dateRange.value?.[0],
      end_date: dateRange.value?.[1]
    }
    
    const { data } = await apiClient.get('/api/work-reports/export', { params })
    if (data.success) {
      // 导出Excel文件
      const ws = XLSX.utils.json_to_sheet(data.data)
      const wb = XLSX.utils.book_new()
      XLSX.utils.book_append_sheet(wb, ws, '报工数据')
      XLSX.writeFile(wb, `报工数据_${new Date().toISOString().split('T')[0]}.xlsx`)
      message.success('导出成功')
    }
  } catch (error) {
    message.error('导出失败')
  } finally {
    exportLoading.value = false
  }
}

const handleImport = () => {
  importVisible.value = true
}

const beforeUpload = (file: File) => {
  const isExcel = file.type === 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' ||
                  file.type === 'application/vnd.ms-excel'
  if (!isExcel) {
    message.error('只能上传 Excel 文件!')
    return false
  }
  const isLt10M = file.size / 1024 / 1024 < 10
  if (!isLt10M) {
    message.error('文件大小不能超过 10MB!')
    return false
  }
  return false // 阻止自动上传
}

const handleImportConfirm = async () => {
  if (fileList.value.length === 0) {
    message.error('请选择要上传的文件')
    return
  }
  
  importLoading.value = true
  try {
    const file = fileList.value[0]
    const data = await readExcelFile(file.originFileObj)
    
    const { data: result } = await apiClient.post('/api/work-reports/import', data)
    if (result.success) {
      message.success(`成功导入 ${result.count} 条记录`)
      importVisible.value = false
      fileList.value = []
      await loadStatistics()
      await handleSearch()
    }
  } catch (error) {
    message.error('导入失败')
  } finally {
    importLoading.value = false
  }
}

const readExcelFile = (file: File): Promise<any[]> => {
  return new Promise((resolve, reject) => {
    const reader = new FileReader()
    reader.onload = (e) => {
      try {
        const data = new Uint8Array(e.target?.result as ArrayBuffer)
        const workbook = XLSX.read(data, { type: 'array' })
        const sheetName = workbook.SheetNames[0]
        const worksheet = workbook.Sheets[sheetName]
        const jsonData = XLSX.utils.sheet_to_json(worksheet)
        resolve(jsonData)
      } catch (error) {
        reject(error)
      }
    }
    reader.onerror = reject
    reader.readAsArrayBuffer(file)
  })
}

const handleView = (record: any) => {
  // 查看详情逻辑
  console.log('查看:', record)
}

const handleEdit = (record: any) => {
  // 编辑逻辑
  console.log('编辑:', record)
}

const getStatusColor = (status: string) => {
  const colors = {
    pending: 'orange',
    approved: 'green',
    rejected: 'red'
  }
  return colors[status] || 'default'
}

const getStatusText = (status: string) => {
  const texts = {
    pending: '待审核',
    approved: '已通过',
    rejected: '已拒绝'
  }
  return texts[status] || status
}

const loadStatistics = async () => {
  try {
    const { data } = await apiClient.get('/api/work-reports/statistics')
    if (data.success) {
      Object.assign(statistics, data.data)
    }
  } catch (error) {
    console.error('加载统计信息失败:', error)
  }
}

// 生命周期
onMounted(() => {
  loadStatistics()
  handleSearch()
})
</script>

<style scoped>
.work-report-agent {
  padding: 24px;
}

.search-section {
  margin-bottom: 24px;
}

.statistics-section {
  margin-bottom: 24px;
}

.table-header {
  margin-bottom: 16px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
</style>
```

### 2. 路由配置

```typescript
// frontend/src/router/index.ts
import { createRouter, createWebHistory } from 'vue-router'
import WorkReportAgent from '../pages/WorkReportAgent.vue'

const routes = [
  // ... 其他路由
  {
    path: '/work-report-agent',
    name: 'WorkReportAgent',
    component: WorkReportAgent,
    meta: {
      title: '报工智能体',
      icon: 'RobotOutlined'
    }
  }
]

const router = createRouter({
  history: createWebHistory(),
  routes
})

export default router
```

## 📋 实施计划

### 第一阶段：数据库设计和后端API（1-2天）
1. 创建数据库表结构
2. 实现数据模型和Repository层
3. 开发API接口
4. 数据导入功能

### 第二阶段：前端页面开发（2-3天）
1. 智能体页面组件开发
2. 搜索和筛选功能
3. 表格展示和分页
4. 数据导入导出功能

### 第三阶段：测试和优化（1天）
1. 功能测试
2. 性能优化
3. 用户体验优化

## 🚀 技术亮点

1. **智能搜索**：支持全文搜索、模糊匹配、拼音搜索
2. **实时统计**：动态显示报工统计信息
3. **数据导入**：支持Excel文件批量导入
4. **响应式设计**：适配不同屏幕尺寸
5. **用户体验**：加载状态、错误提示、操作反馈

## 📊 预期效果

- 用户可以通过关键字快速搜索报工记录
- 支持多维度筛选和排序
- 提供直观的统计信息展示
- 支持数据导入导出功能
- 提供良好的用户交互体验

这个技术方案提供了完整的报工智能体系统实现，包括数据库设计、后端API、前端页面等，可以满足用户的需求。
