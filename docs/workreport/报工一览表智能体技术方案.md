# æŠ¥å·¥ä¸€è§ˆè¡¨æ™ºèƒ½ä½“æŠ€æœ¯æ–¹æ¡ˆ

## ğŸ“‹ éœ€æ±‚æ¦‚è¿°

åŸºäº `æŠ¥å·¥ä¸€è§ˆè¡¨æ‰€éœ€æ•°æ®.xlsx` æ–‡ä»¶ï¼Œå¼€å‘ä¸€ä¸ªæ™ºèƒ½ä½“é¡µé¢ï¼Œæ”¯æŒç”¨æˆ·é€šè¿‡å…³é”®å­—æœç´¢æŠ¥å·¥æ•°æ®ï¼Œå¹¶ä»¥è¡¨æ ¼å½¢å¼å±•ç¤ºæœç´¢ç»“æœã€‚

## ğŸ¯ åŠŸèƒ½éœ€æ±‚

### æ ¸å¿ƒåŠŸèƒ½
1. **æ•°æ®å¯¼å…¥**ï¼šå°†Excelæ–‡ä»¶ä¸­çš„æŠ¥å·¥æ•°æ®å¯¼å…¥åˆ°æ•°æ®åº“
2. **æ™ºèƒ½æœç´¢**ï¼šæ”¯æŒå…³é”®å­—æ¨¡ç³Šæœç´¢ï¼Œå¿«é€Ÿå®šä½ç›¸å…³æŠ¥å·¥è®°å½•
3. **è¡¨æ ¼å±•ç¤º**ï¼šä»¥æ¸…æ™°çš„è¡¨æ ¼å½¢å¼å±•ç¤ºæœç´¢ç»“æœ
4. **æ•°æ®ç­›é€‰**ï¼šæ”¯æŒå¤šç»´åº¦æ•°æ®ç­›é€‰å’Œæ’åº

### ç”¨æˆ·äº¤äº’
- è¾“å…¥æœç´¢å…³é”®å­—ï¼ˆå¦‚ï¼šå‘˜å·¥å§“åã€é¡¹ç›®åç§°ã€æ—¥æœŸç­‰ï¼‰
- å®æ—¶æœç´¢ç»“æœæ˜¾ç¤º
- æ”¯æŒé«˜çº§ç­›é€‰æ¡ä»¶
- æ”¯æŒæ•°æ®å¯¼å‡ºåŠŸèƒ½

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### ç³»ç»Ÿæ¶æ„å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æŠ¥å·¥æ™ºèƒ½ä½“ç³»ç»Ÿ                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å‰ç«¯é¡µé¢      â”‚    â”‚   åç«¯API       â”‚    â”‚   æ•°æ®åº“        â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ â€¢ æœç´¢ç•Œé¢      â”‚    â”‚ â€¢ æ•°æ®å¯¼å…¥API   â”‚    â”‚ â€¢ æŠ¥å·¥ä¸»è¡¨      â”‚
â”‚ â€¢ ç»“æœå±•ç¤º      â”‚    â”‚ â€¢ æœç´¢API       â”‚    â”‚ â€¢ å‘˜å·¥ä¿¡æ¯è¡¨    â”‚
â”‚ â€¢ ç­›é€‰ç»„ä»¶      â”‚    â”‚ â€¢ å¯¼å‡ºAPI       â”‚    â”‚ â€¢ é¡¹ç›®ä¿¡æ¯è¡¨    â”‚
â”‚ â€¢ æ•°æ®å¯¼å‡º      â”‚    â”‚ â€¢ ç»Ÿè®¡API       â”‚    â”‚ â€¢ éƒ¨é—¨ä¿¡æ¯è¡¨    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                      â”‚                      â”‚
          â”‚ HTTP/WebSocket       â”‚ MongoDB/MySQL        â”‚
          â”‚                      â”‚                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æ™ºèƒ½æœç´¢å¼•æ“                             â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ å…¨æ–‡æœç´¢     â”‚  â”‚ æ¨¡ç³ŠåŒ¹é…     â”‚  â”‚ æ™ºèƒ½æ¨è     â”‚            â”‚
â”‚  â”‚             â”‚  â”‚             â”‚  â”‚             â”‚            â”‚
â”‚  â”‚ â€¢ å…³é”®å­—ç´¢å¼• â”‚  â”‚ â€¢ æ‹¼éŸ³æœç´¢   â”‚  â”‚ â€¢ ç›¸å…³æ¨è   â”‚            â”‚
â”‚  â”‚ â€¢ åˆ†è¯å¤„ç†   â”‚  â”‚ â€¢ æ¨¡ç³ŠæŸ¥è¯¢   â”‚  â”‚ â€¢ å†å²æœç´¢   â”‚            â”‚
â”‚  â”‚ â€¢ æƒé‡æ’åº   â”‚  â”‚ â€¢ å®¹é”™å¤„ç†   â”‚  â”‚ â€¢ æ™ºèƒ½æç¤º   â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š æ•°æ®åº“è®¾è®¡

### 1. æŠ¥å·¥ä¸»è¡¨ (work_reports)
```sql
CREATE TABLE work_reports (
    id VARCHAR(50) PRIMARY KEY COMMENT 'æŠ¥å·¥ID',
    employee_id VARCHAR(50) NOT NULL COMMENT 'å‘˜å·¥ID',
    project_id VARCHAR(50) NOT NULL COMMENT 'é¡¹ç›®ID',
    department_id VARCHAR(50) NOT NULL COMMENT 'éƒ¨é—¨ID',
    report_date DATE NOT NULL COMMENT 'æŠ¥å·¥æ—¥æœŸ',
    work_hours DECIMAL(5,2) NOT NULL COMMENT 'å·¥ä½œæ—¶é•¿(å°æ—¶)',
    work_content TEXT COMMENT 'å·¥ä½œå†…å®¹',
    work_location VARCHAR(100) COMMENT 'å·¥ä½œåœ°ç‚¹',
    status ENUM('pending', 'approved', 'rejected') DEFAULT 'pending' COMMENT 'çŠ¶æ€',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    INDEX idx_employee_date (employee_id, report_date),
    INDEX idx_project_date (project_id, report_date),
    INDEX idx_department_date (department_id, report_date),
    FULLTEXT INDEX idx_content (work_content)
) COMMENT 'æŠ¥å·¥ä¸»è¡¨';
```

### 2. å‘˜å·¥ä¿¡æ¯è¡¨ (employees)
```sql
CREATE TABLE employees (
    id VARCHAR(50) PRIMARY KEY COMMENT 'å‘˜å·¥ID',
    employee_no VARCHAR(20) UNIQUE NOT NULL COMMENT 'å‘˜å·¥ç¼–å·',
    name VARCHAR(50) NOT NULL COMMENT 'å‘˜å·¥å§“å',
    pinyin VARCHAR(100) COMMENT 'å§“åæ‹¼éŸ³',
    phone VARCHAR(20) COMMENT 'æ‰‹æœºå·',
    email VARCHAR(100) COMMENT 'é‚®ç®±',
    position VARCHAR(50) COMMENT 'èŒä½',
    department_id VARCHAR(50) COMMENT 'éƒ¨é—¨ID',
    hire_date DATE COMMENT 'å…¥èŒæ—¥æœŸ',
    status ENUM('active', 'inactive') DEFAULT 'active' COMMENT 'çŠ¶æ€',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    INDEX idx_name (name),
    INDEX idx_pinyin (pinyin),
    INDEX idx_employee_no (employee_no),
    INDEX idx_department (department_id)
) COMMENT 'å‘˜å·¥ä¿¡æ¯è¡¨';
```

### 3. é¡¹ç›®ä¿¡æ¯è¡¨ (projects)
```sql
CREATE TABLE projects (
    id VARCHAR(50) PRIMARY KEY COMMENT 'é¡¹ç›®ID',
    project_code VARCHAR(20) UNIQUE NOT NULL COMMENT 'é¡¹ç›®ç¼–ç ',
    project_name VARCHAR(100) NOT NULL COMMENT 'é¡¹ç›®åç§°',
    project_type VARCHAR(50) COMMENT 'é¡¹ç›®ç±»å‹',
    manager_id VARCHAR(50) COMMENT 'é¡¹ç›®ç»ç†ID',
    start_date DATE COMMENT 'å¼€å§‹æ—¥æœŸ',
    end_date DATE COMMENT 'ç»“æŸæ—¥æœŸ',
    status ENUM('planning', 'active', 'completed', 'suspended') DEFAULT 'active' COMMENT 'é¡¹ç›®çŠ¶æ€',
    description TEXT COMMENT 'é¡¹ç›®æè¿°',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    INDEX idx_name (project_name),
    INDEX idx_code (project_code),
    INDEX idx_manager (manager_id),
    INDEX idx_status (status)
) COMMENT 'é¡¹ç›®ä¿¡æ¯è¡¨';
```

### 4. éƒ¨é—¨ä¿¡æ¯è¡¨ (departments)
```sql
CREATE TABLE departments (
    id VARCHAR(50) PRIMARY KEY COMMENT 'éƒ¨é—¨ID',
    department_code VARCHAR(20) UNIQUE NOT NULL COMMENT 'éƒ¨é—¨ç¼–ç ',
    department_name VARCHAR(50) NOT NULL COMMENT 'éƒ¨é—¨åç§°',
    parent_id VARCHAR(50) COMMENT 'ä¸Šçº§éƒ¨é—¨ID',
    manager_id VARCHAR(50) COMMENT 'éƒ¨é—¨ç»ç†ID',
    level INT DEFAULT 1 COMMENT 'éƒ¨é—¨å±‚çº§',
    sort_order INT DEFAULT 0 COMMENT 'æ’åº',
    status ENUM('active', 'inactive') DEFAULT 'active' COMMENT 'çŠ¶æ€',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    INDEX idx_name (department_name),
    INDEX idx_code (department_code),
    INDEX idx_parent (parent_id),
    INDEX idx_level (level)
) COMMENT 'éƒ¨é—¨ä¿¡æ¯è¡¨';
```

## ğŸ”§ åç«¯å®ç°

### 1. æ•°æ®æ¨¡å‹ (schemas)

#### æŠ¥å·¥æ•°æ®æ¨¡å‹
```python
# backend/app/schemas/work_report.py
from pydantic import BaseModel, Field
from datetime import date, datetime
from typing import Optional
from enum import Enum

class WorkReportStatus(str, Enum):
    PENDING = "pending"
    APPROVED = "approved"
    REJECTED = "rejected"

class WorkReportBase(BaseModel):
    employee_id: str = Field(..., description="å‘˜å·¥ID")
    project_id: str = Field(..., description="é¡¹ç›®ID")
    department_id: str = Field(..., description="éƒ¨é—¨ID")
    report_date: date = Field(..., description="æŠ¥å·¥æ—¥æœŸ")
    work_hours: float = Field(..., ge=0, le=24, description="å·¥ä½œæ—¶é•¿")
    work_content: Optional[str] = Field(None, description="å·¥ä½œå†…å®¹")
    work_location: Optional[str] = Field(None, description="å·¥ä½œåœ°ç‚¹")
    status: WorkReportStatus = Field(WorkReportStatus.PENDING, description="çŠ¶æ€")

class WorkReportCreate(WorkReportBase):
    pass

class WorkReportUpdate(BaseModel):
    work_hours: Optional[float] = Field(None, ge=0, le=24)
    work_content: Optional[str] = None
    work_location: Optional[str] = None
    status: Optional[WorkReportStatus] = None

class WorkReportResponse(WorkReportBase):
    id: str
    created_at: datetime
    updated_at: datetime
    
    # å…³è”ä¿¡æ¯
    employee_name: Optional[str] = None
    project_name: Optional[str] = None
    department_name: Optional[str] = None
    
    class Config:
        from_attributes = True

class WorkReportSearchRequest(BaseModel):
    keyword: Optional[str] = Field(None, description="æœç´¢å…³é”®å­—")
    employee_name: Optional[str] = Field(None, description="å‘˜å·¥å§“å")
    project_name: Optional[str] = Field(None, description="é¡¹ç›®åç§°")
    department_name: Optional[str] = Field(None, description="éƒ¨é—¨åç§°")
    start_date: Optional[date] = Field(None, description="å¼€å§‹æ—¥æœŸ")
    end_date: Optional[date] = Field(None, description="ç»“æŸæ—¥æœŸ")
    status: Optional[WorkReportStatus] = Field(None, description="çŠ¶æ€")
    page: int = Field(1, ge=1, description="é¡µç ")
    size: int = Field(20, ge=1, le=100, description="æ¯é¡µæ•°é‡")
```

### 2. æ•°æ®è®¿é—®å±‚ (repository)

```python
# backend/app/repository/work_report_repo.py
from typing import List, Optional, Dict, Any
from datetime import date
from pymongo import MongoClient
from bson import ObjectId
import re

class WorkReportRepository:
    def __init__(self, db):
        self.db = db
        self.collection = db.work_reports
    
    async def search_work_reports(
        self, 
        keyword: Optional[str] = None,
        employee_name: Optional[str] = None,
        project_name: Optional[str] = None,
        department_name: Optional[str] = None,
        start_date: Optional[date] = None,
        end_date: Optional[date] = None,
        status: Optional[str] = None,
        page: int = 1,
        size: int = 20
    ) -> Dict[str, Any]:
        """æ™ºèƒ½æœç´¢æŠ¥å·¥è®°å½•"""
        
        # æ„å»ºæŸ¥è¯¢æ¡ä»¶
        query = {}
        
        # å…³é”®å­—æœç´¢ï¼ˆå…¨æ–‡æœç´¢ï¼‰
        if keyword:
            query["$or"] = [
                {"work_content": {"$regex": keyword, "$options": "i"}},
                {"employee_name": {"$regex": keyword, "$options": "i"}},
                {"project_name": {"$regex": keyword, "$options": "i"}},
                {"department_name": {"$regex": keyword, "$options": "i"}},
                {"work_location": {"$regex": keyword, "$options": "i"}}
            ]
        
        # ç²¾ç¡®åŒ¹é…
        if employee_name:
            query["employee_name"] = {"$regex": employee_name, "$options": "i"}
        if project_name:
            query["project_name"] = {"$regex": project_name, "$options": "i"}
        if department_name:
            query["department_name"] = {"$regex": department_name, "$options": "i"}
        if status:
            query["status"] = status
        
        # æ—¥æœŸèŒƒå›´
        if start_date or end_date:
            date_query = {}
            if start_date:
                date_query["$gte"] = start_date
            if end_date:
                date_query["$lte"] = end_date
            query["report_date"] = date_query
        
        # æ‰§è¡ŒæŸ¥è¯¢
        total = await self.collection.count_documents(query)
        skip = (page - 1) * size
        
        cursor = self.collection.find(query).skip(skip).limit(size).sort("report_date", -1)
        results = await cursor.to_list(length=size)
        
        return {
            "total": total,
            "page": page,
            "size": size,
            "data": results
        }
    
    async def get_work_report_statistics(self) -> Dict[str, Any]:
        """è·å–æŠ¥å·¥ç»Ÿè®¡ä¿¡æ¯"""
        pipeline = [
            {
                "$group": {
                    "_id": None,
                    "total_reports": {"$sum": 1},
                    "total_hours": {"$sum": "$work_hours"},
                    "avg_hours": {"$avg": "$work_hours"}
                }
            }
        ]
        
        result = await self.collection.aggregate(pipeline).to_list(1)
        return result[0] if result else {}
    
    async def import_excel_data(self, data: List[Dict]) -> int:
        """å¯¼å…¥Excelæ•°æ®"""
        try:
            result = await self.collection.insert_many(data)
            return len(result.inserted_ids)
        except Exception as e:
            raise Exception(f"æ•°æ®å¯¼å…¥å¤±è´¥: {str(e)}")
```

### 3. APIæ¥å£ (routes)

```python
# backend/app/api/v1/work_reports.py
from fastapi import APIRouter, Depends, HTTPException, Query
from typing import Optional, List
from datetime import date
from ...schemas.work_report import (
    WorkReportResponse, 
    WorkReportSearchRequest,
    WorkReportCreate,
    WorkReportUpdate
)
from ...repository.work_report_repo import WorkReportRepository
from ...db.mongo import get_db

router = APIRouter(prefix="/work-reports", tags=["æŠ¥å·¥ç®¡ç†"])

@router.get("/search", response_model=Dict[str, Any])
async def search_work_reports(
    keyword: Optional[str] = Query(None, description="æœç´¢å…³é”®å­—"),
    employee_name: Optional[str] = Query(None, description="å‘˜å·¥å§“å"),
    project_name: Optional[str] = Query(None, description="é¡¹ç›®åç§°"),
    department_name: Optional[str] = Query(None, description="éƒ¨é—¨åç§°"),
    start_date: Optional[date] = Query(None, description="å¼€å§‹æ—¥æœŸ"),
    end_date: Optional[date] = Query(None, description="ç»“æŸæ—¥æœŸ"),
    status: Optional[str] = Query(None, description="çŠ¶æ€"),
    page: int = Query(1, ge=1, description="é¡µç "),
    size: int = Query(20, ge=1, le=100, description="æ¯é¡µæ•°é‡"),
    db = Depends(get_db)
):
    """æ™ºèƒ½æœç´¢æŠ¥å·¥è®°å½•"""
    try:
        repo = WorkReportRepository(db)
        result = await repo.search_work_reports(
            keyword=keyword,
            employee_name=employee_name,
            project_name=project_name,
            department_name=department_name,
            start_date=start_date,
            end_date=end_date,
            status=status,
            page=page,
            size=size
        )
        return {
            "success": True,
            "data": result
        }
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))

@router.post("/import")
async def import_excel_data(
    data: List[Dict],
    db = Depends(get_db)
):
    """å¯¼å…¥Excelæ•°æ®"""
    try:
        repo = WorkReportRepository(db)
        count = await repo.import_excel_data(data)
        return {
            "success": True,
            "message": f"æˆåŠŸå¯¼å…¥ {count} æ¡è®°å½•",
            "count": count
        }
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))

@router.get("/statistics")
async def get_statistics(db = Depends(get_db)):
    """è·å–æŠ¥å·¥ç»Ÿè®¡ä¿¡æ¯"""
    try:
        repo = WorkReportRepository(db)
        stats = await repo.get_work_report_statistics()
        return {
            "success": True,
            "data": stats
        }
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))

@router.get("/export")
async def export_data(
    keyword: Optional[str] = None,
    start_date: Optional[date] = None,
    end_date: Optional[date] = None,
    db = Depends(get_db)
):
    """å¯¼å‡ºæ•°æ®"""
    try:
        repo = WorkReportRepository(db)
        result = await repo.search_work_reports(
            keyword=keyword,
            start_date=start_date,
            end_date=end_date,
            page=1,
            size=10000  # å¯¼å‡ºæ‰€æœ‰æ•°æ®
        )
        return {
            "success": True,
            "data": result["data"]
        }
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))
```

## ğŸ¨ å‰ç«¯å®ç°

### 1. æ™ºèƒ½ä½“é¡µé¢ç»„ä»¶

```vue
<!-- frontend/src/pages/WorkReportAgent.vue -->
<template>
  <div class="work-report-agent">
    <a-card title="æŠ¥å·¥æ™ºèƒ½ä½“" :bordered="false">
      <!-- æœç´¢åŒºåŸŸ -->
      <div class="search-section">
        <a-row :gutter="16">
          <a-col :span="8">
            <a-input
              v-model:value="searchForm.keyword"
              placeholder="è¾“å…¥å…³é”®å­—æœç´¢ï¼ˆå‘˜å·¥å§“åã€é¡¹ç›®åç§°ã€å·¥ä½œå†…å®¹ç­‰ï¼‰"
              @pressEnter="handleSearch"
              allowClear
            >
              <template #prefix>
                <SearchOutlined />
              </template>
            </a-input>
          </a-col>
          <a-col :span="4">
            <a-input
              v-model:value="searchForm.employee_name"
              placeholder="å‘˜å·¥å§“å"
              allowClear
            />
          </a-col>
          <a-col :span="4">
            <a-input
              v-model:value="searchForm.project_name"
              placeholder="é¡¹ç›®åç§°"
              allowClear
            />
          </a-col>
          <a-col :span="4">
            <a-select
              v-model:value="searchForm.status"
              placeholder="çŠ¶æ€"
              allowClear
              style="width: 100%"
            >
              <a-select-option value="pending">å¾…å®¡æ ¸</a-select-option>
              <a-select-option value="approved">å·²é€šè¿‡</a-select-option>
              <a-select-option value="rejected">å·²æ‹’ç»</a-select-option>
            </a-select>
          </a-col>
          <a-col :span="4">
            <a-space>
              <a-button type="primary" @click="handleSearch">
                <SearchOutlined /> æœç´¢
              </a-button>
              <a-button @click="handleReset">
                <ReloadOutlined /> é‡ç½®
              </a-button>
            </a-space>
          </a-col>
        </a-row>
        
        <!-- é«˜çº§æœç´¢ -->
        <a-collapse v-model:activeKey="advancedSearchKey" ghost>
          <a-collapse-panel key="advanced" header="é«˜çº§æœç´¢">
            <a-row :gutter="16">
              <a-col :span="6">
                <a-range-picker
                  v-model:value="dateRange"
                  placeholder="é€‰æ‹©æ—¥æœŸèŒƒå›´"
                />
              </a-col>
              <a-col :span="6">
                <a-input
                  v-model:value="searchForm.department_name"
                  placeholder="éƒ¨é—¨åç§°"
                  allowClear
                />
              </a-col>
              <a-col :span="6">
                <a-button type="primary" @click="handleAdvancedSearch">
                  é«˜çº§æœç´¢
                </a-button>
              </a-col>
            </a-row>
          </a-collapse-panel>
        </a-collapse>
      </div>

      <a-divider />

      <!-- ç»Ÿè®¡ä¿¡æ¯ -->
      <div class="statistics-section">
        <a-row :gutter="16">
          <a-col :span="6">
            <a-statistic title="æ€»æŠ¥å·¥è®°å½•" :value="statistics.total_reports" />
          </a-col>
          <a-col :span="6">
            <a-statistic title="æ€»å·¥ä½œæ—¶é•¿" :value="statistics.total_hours" suffix="å°æ—¶" />
          </a-col>
          <a-col :span="6">
            <a-statistic title="å¹³å‡å·¥ä½œæ—¶é•¿" :value="statistics.avg_hours" suffix="å°æ—¶" :precision="2" />
          </a-col>
          <a-col :span="6">
            <a-statistic title="æœç´¢ç»“æœ" :value="searchResult.total" />
          </a-col>
        </a-row>
      </div>

      <a-divider />

      <!-- ç»“æœå±•ç¤º -->
      <div class="results-section">
        <div class="table-header">
          <a-space>
            <a-button @click="handleExport" :loading="exportLoading">
              <DownloadOutlined /> å¯¼å‡ºæ•°æ®
            </a-button>
            <a-button @click="handleImport">
              <UploadOutlined /> å¯¼å…¥æ•°æ®
            </a-button>
          </a-space>
        </div>

        <a-table
          :dataSource="searchResult.data"
          :columns="columns"
          :loading="loading"
          :pagination="pagination"
          rowKey="id"
          :scroll="{ x: 1200 }"
        >
          <template #bodyCell="{ column, record }">
            <template v-if="column.key === 'status'">
              <a-tag :color="getStatusColor(record.status)">
                {{ getStatusText(record.status) }}
              </a-tag>
            </template>
            <template v-else-if="column.key === 'work_hours'">
              {{ record.work_hours }}å°æ—¶
            </template>
            <template v-else-if="column.key === 'actions'">
              <a-space>
                <a-button size="small" @click="handleView(record)">æŸ¥çœ‹</a-button>
                <a-button size="small" type="primary" @click="handleEdit(record)">ç¼–è¾‘</a-button>
              </a-space>
            </template>
          </template>
        </a-table>
      </div>
    </a-card>

    <!-- æ•°æ®å¯¼å…¥æ¨¡æ€æ¡† -->
    <a-modal
      v-model:open="importVisible"
      title="å¯¼å…¥æŠ¥å·¥æ•°æ®"
      @ok="handleImportConfirm"
      :confirmLoading="importLoading"
    >
      <a-upload-dragger
        v-model:fileList="fileList"
        :beforeUpload="beforeUpload"
        accept=".xlsx,.xls"
        :multiple="false"
      >
        <p class="ant-upload-drag-icon">
          <InboxOutlined />
        </p>
        <p class="ant-upload-text">ç‚¹å‡»æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤åŒºåŸŸä¸Šä¼ </p>
        <p class="ant-upload-hint">æ”¯æŒ .xlsx å’Œ .xls æ ¼å¼</p>
      </a-upload-dragger>
    </a-modal>
  </div>
</template>

<script setup lang="ts">
import { ref, reactive, onMounted, computed } from 'vue'
import { message } from 'ant-design-vue'
import { 
  SearchOutlined, 
  ReloadOutlined, 
  DownloadOutlined, 
  UploadOutlined,
  InboxOutlined 
} from '@ant-design/icons-vue'
import apiClient from '../utils/axios'
import * as XLSX from 'xlsx'

// å“åº”å¼æ•°æ®
const loading = ref(false)
const exportLoading = ref(false)
const importLoading = ref(false)
const importVisible = ref(false)
const advancedSearchKey = ref([])
const fileList = ref([])

// æœç´¢è¡¨å•
const searchForm = reactive({
  keyword: '',
  employee_name: '',
  project_name: '',
  department_name: '',
  status: undefined
})

const dateRange = ref([])

// æœç´¢ç»“æœ
const searchResult = reactive({
  data: [],
  total: 0,
  page: 1,
  size: 20
})

// ç»Ÿè®¡ä¿¡æ¯
const statistics = reactive({
  total_reports: 0,
  total_hours: 0,
  avg_hours: 0
})

// è¡¨æ ¼åˆ—å®šä¹‰
const columns = [
  {
    title: 'å‘˜å·¥å§“å',
    dataIndex: 'employee_name',
    key: 'employee_name',
    width: 100,
    fixed: 'left'
  },
  {
    title: 'é¡¹ç›®åç§°',
    dataIndex: 'project_name',
    key: 'project_name',
    width: 150
  },
  {
    title: 'éƒ¨é—¨',
    dataIndex: 'department_name',
    key: 'department_name',
    width: 100
  },
  {
    title: 'æŠ¥å·¥æ—¥æœŸ',
    dataIndex: 'report_date',
    key: 'report_date',
    width: 120
  },
  {
    title: 'å·¥ä½œæ—¶é•¿',
    dataIndex: 'work_hours',
    key: 'work_hours',
    width: 100
  },
  {
    title: 'å·¥ä½œå†…å®¹',
    dataIndex: 'work_content',
    key: 'work_content',
    width: 200,
    ellipsis: true
  },
  {
    title: 'å·¥ä½œåœ°ç‚¹',
    dataIndex: 'work_location',
    key: 'work_location',
    width: 120
  },
  {
    title: 'çŠ¶æ€',
    dataIndex: 'status',
    key: 'status',
    width: 80
  },
  {
    title: 'æ“ä½œ',
    key: 'actions',
    width: 120,
    fixed: 'right'
  }
]

// åˆ†é¡µé…ç½®
const pagination = computed(() => ({
  current: searchResult.page,
  pageSize: searchResult.size,
  total: searchResult.total,
  showSizeChanger: true,
  showQuickJumper: true,
  showTotal: (total: number) => `å…± ${total} æ¡è®°å½•`,
  onChange: (page: number, size: number) => {
    searchResult.page = page
    searchResult.size = size
    handleSearch()
  }
}))

// æ–¹æ³•
const handleSearch = async () => {
  loading.value = true
  try {
    const params = {
      ...searchForm,
      start_date: dateRange.value?.[0],
      end_date: dateRange.value?.[1],
      page: searchResult.page,
      size: searchResult.size
    }
    
    const { data } = await apiClient.get('/api/work-reports/search', { params })
    if (data.success) {
      searchResult.data = data.data.data
      searchResult.total = data.data.total
    }
  } catch (error) {
    message.error('æœç´¢å¤±è´¥')
  } finally {
    loading.value = false
  }
}

const handleReset = () => {
  Object.assign(searchForm, {
    keyword: '',
    employee_name: '',
    project_name: '',
    department_name: '',
    status: undefined
  })
  dateRange.value = []
  searchResult.page = 1
  handleSearch()
}

const handleAdvancedSearch = () => {
  advancedSearchKey.value = []
  handleSearch()
}

const handleExport = async () => {
  exportLoading.value = true
  try {
    const params = {
      keyword: searchForm.keyword,
      start_date: dateRange.value?.[0],
      end_date: dateRange.value?.[1]
    }
    
    const { data } = await apiClient.get('/api/work-reports/export', { params })
    if (data.success) {
      // å¯¼å‡ºExcelæ–‡ä»¶
      const ws = XLSX.utils.json_to_sheet(data.data)
      const wb = XLSX.utils.book_new()
      XLSX.utils.book_append_sheet(wb, ws, 'æŠ¥å·¥æ•°æ®')
      XLSX.writeFile(wb, `æŠ¥å·¥æ•°æ®_${new Date().toISOString().split('T')[0]}.xlsx`)
      message.success('å¯¼å‡ºæˆåŠŸ')
    }
  } catch (error) {
    message.error('å¯¼å‡ºå¤±è´¥')
  } finally {
    exportLoading.value = false
  }
}

const handleImport = () => {
  importVisible.value = true
}

const beforeUpload = (file: File) => {
  const isExcel = file.type === 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' ||
                  file.type === 'application/vnd.ms-excel'
  if (!isExcel) {
    message.error('åªèƒ½ä¸Šä¼  Excel æ–‡ä»¶!')
    return false
  }
  const isLt10M = file.size / 1024 / 1024 < 10
  if (!isLt10M) {
    message.error('æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡ 10MB!')
    return false
  }
  return false // é˜»æ­¢è‡ªåŠ¨ä¸Šä¼ 
}

const handleImportConfirm = async () => {
  if (fileList.value.length === 0) {
    message.error('è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶')
    return
  }
  
  importLoading.value = true
  try {
    const file = fileList.value[0]
    const data = await readExcelFile(file.originFileObj)
    
    const { data: result } = await apiClient.post('/api/work-reports/import', data)
    if (result.success) {
      message.success(`æˆåŠŸå¯¼å…¥ ${result.count} æ¡è®°å½•`)
      importVisible.value = false
      fileList.value = []
      await loadStatistics()
      await handleSearch()
    }
  } catch (error) {
    message.error('å¯¼å…¥å¤±è´¥')
  } finally {
    importLoading.value = false
  }
}

const readExcelFile = (file: File): Promise<any[]> => {
  return new Promise((resolve, reject) => {
    const reader = new FileReader()
    reader.onload = (e) => {
      try {
        const data = new Uint8Array(e.target?.result as ArrayBuffer)
        const workbook = XLSX.read(data, { type: 'array' })
        const sheetName = workbook.SheetNames[0]
        const worksheet = workbook.Sheets[sheetName]
        const jsonData = XLSX.utils.sheet_to_json(worksheet)
        resolve(jsonData)
      } catch (error) {
        reject(error)
      }
    }
    reader.onerror = reject
    reader.readAsArrayBuffer(file)
  })
}

const handleView = (record: any) => {
  // æŸ¥çœ‹è¯¦æƒ…é€»è¾‘
  console.log('æŸ¥çœ‹:', record)
}

const handleEdit = (record: any) => {
  // ç¼–è¾‘é€»è¾‘
  console.log('ç¼–è¾‘:', record)
}

const getStatusColor = (status: string) => {
  const colors = {
    pending: 'orange',
    approved: 'green',
    rejected: 'red'
  }
  return colors[status] || 'default'
}

const getStatusText = (status: string) => {
  const texts = {
    pending: 'å¾…å®¡æ ¸',
    approved: 'å·²é€šè¿‡',
    rejected: 'å·²æ‹’ç»'
  }
  return texts[status] || status
}

const loadStatistics = async () => {
  try {
    const { data } = await apiClient.get('/api/work-reports/statistics')
    if (data.success) {
      Object.assign(statistics, data.data)
    }
  } catch (error) {
    console.error('åŠ è½½ç»Ÿè®¡ä¿¡æ¯å¤±è´¥:', error)
  }
}

// ç”Ÿå‘½å‘¨æœŸ
onMounted(() => {
  loadStatistics()
  handleSearch()
})
</script>

<style scoped>
.work-report-agent {
  padding: 24px;
}

.search-section {
  margin-bottom: 24px;
}

.statistics-section {
  margin-bottom: 24px;
}

.table-header {
  margin-bottom: 16px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
</style>
```

### 2. è·¯ç”±é…ç½®

```typescript
// frontend/src/router/index.ts
import { createRouter, createWebHistory } from 'vue-router'
import WorkReportAgent from '../pages/WorkReportAgent.vue'

const routes = [
  // ... å…¶ä»–è·¯ç”±
  {
    path: '/work-report-agent',
    name: 'WorkReportAgent',
    component: WorkReportAgent,
    meta: {
      title: 'æŠ¥å·¥æ™ºèƒ½ä½“',
      icon: 'RobotOutlined'
    }
  }
]

const router = createRouter({
  history: createWebHistory(),
  routes
})

export default router
```

## ğŸ“‹ å®æ–½è®¡åˆ’

### ç¬¬ä¸€é˜¶æ®µï¼šæ•°æ®åº“è®¾è®¡å’Œåç«¯APIï¼ˆ1-2å¤©ï¼‰
1. åˆ›å»ºæ•°æ®åº“è¡¨ç»“æ„
2. å®ç°æ•°æ®æ¨¡å‹å’ŒRepositoryå±‚
3. å¼€å‘APIæ¥å£
4. æ•°æ®å¯¼å…¥åŠŸèƒ½

### ç¬¬äºŒé˜¶æ®µï¼šå‰ç«¯é¡µé¢å¼€å‘ï¼ˆ2-3å¤©ï¼‰
1. æ™ºèƒ½ä½“é¡µé¢ç»„ä»¶å¼€å‘
2. æœç´¢å’Œç­›é€‰åŠŸèƒ½
3. è¡¨æ ¼å±•ç¤ºå’Œåˆ†é¡µ
4. æ•°æ®å¯¼å…¥å¯¼å‡ºåŠŸèƒ½

### ç¬¬ä¸‰é˜¶æ®µï¼šæµ‹è¯•å’Œä¼˜åŒ–ï¼ˆ1å¤©ï¼‰
1. åŠŸèƒ½æµ‹è¯•
2. æ€§èƒ½ä¼˜åŒ–
3. ç”¨æˆ·ä½“éªŒä¼˜åŒ–

## ğŸš€ æŠ€æœ¯äº®ç‚¹

1. **æ™ºèƒ½æœç´¢**ï¼šæ”¯æŒå…¨æ–‡æœç´¢ã€æ¨¡ç³ŠåŒ¹é…ã€æ‹¼éŸ³æœç´¢
2. **å®æ—¶ç»Ÿè®¡**ï¼šåŠ¨æ€æ˜¾ç¤ºæŠ¥å·¥ç»Ÿè®¡ä¿¡æ¯
3. **æ•°æ®å¯¼å…¥**ï¼šæ”¯æŒExcelæ–‡ä»¶æ‰¹é‡å¯¼å…¥
4. **å“åº”å¼è®¾è®¡**ï¼šé€‚é…ä¸åŒå±å¹•å°ºå¯¸
5. **ç”¨æˆ·ä½“éªŒ**ï¼šåŠ è½½çŠ¶æ€ã€é”™è¯¯æç¤ºã€æ“ä½œåé¦ˆ

## ğŸ“Š é¢„æœŸæ•ˆæœ

- ç”¨æˆ·å¯ä»¥é€šè¿‡å…³é”®å­—å¿«é€Ÿæœç´¢æŠ¥å·¥è®°å½•
- æ”¯æŒå¤šç»´åº¦ç­›é€‰å’Œæ’åº
- æä¾›ç›´è§‚çš„ç»Ÿè®¡ä¿¡æ¯å±•ç¤º
- æ”¯æŒæ•°æ®å¯¼å…¥å¯¼å‡ºåŠŸèƒ½
- æä¾›è‰¯å¥½çš„ç”¨æˆ·äº¤äº’ä½“éªŒ

è¿™ä¸ªæŠ€æœ¯æ–¹æ¡ˆæä¾›äº†å®Œæ•´çš„æŠ¥å·¥æ™ºèƒ½ä½“ç³»ç»Ÿå®ç°ï¼ŒåŒ…æ‹¬æ•°æ®åº“è®¾è®¡ã€åç«¯APIã€å‰ç«¯é¡µé¢ç­‰ï¼Œå¯ä»¥æ»¡è¶³ç”¨æˆ·çš„éœ€æ±‚ã€‚
